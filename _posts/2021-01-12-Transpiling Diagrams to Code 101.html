<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Transpiling Diagrams to Code 101</title>
  <meta name="CreationTime" content="2021-01-12T17:29:39Z">
  <meta name="ModificationTime" content="2021-01-12T17:29:39Z">
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1894.6">
  <style type="text/css">
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 13.0px Palatino}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 13.0px Palatino; min-height: 18.0px}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 11.0px Menlo}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino; min-height: 18.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 16.0px Times; color: #000000; -webkit-text-stroke: #000000; background-color: #ffffff; min-height: 19.0px}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 13.0px Palatino; color: #000000; -webkit-text-stroke: #000000; background-color: #ffffff}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 13.0px Palatino; color: #000000; -webkit-text-stroke: #000000; background-color: #ffffff; min-height: 18.0px}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 13.0px Palatino; color: #000000; -webkit-text-stroke: #000000}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 13.0px Times; color: #000000; -webkit-text-stroke: #000000; background-color: #ffffff; min-height: 16.0px}
    p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 16.0px Times; color: #000000; -webkit-text-stroke: #000000; background-color: #ffffff}
    p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 16.0px Times; -webkit-text-stroke: #000000; min-height: 19.0px}
    p.p14 {margin: 0.0px 0.0px 0.0px 36.0px; font: 11.0px Menlo}
    p.p15 {margin: 0.0px 0.0px 0.0px 36.0px; font: 11.0px Menlo; min-height: 13.0px}
    p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 11.0px Menlo; min-height: 13.0px}
    p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
    p.p18 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    li.li5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino}
    span.s1 {font: 13.0px Palatino}
    span.s2 {font: 11.0px Menlo}
    span.s3 {font: 16.0px Times; font-kerning: none; color: #000000; background-color: #ffffff; -webkit-text-stroke: 0px #000000}
    span.s4 {font-kerning: none}
    span.s5 {font-kerning: none; background-color: #ffffff}
    span.s6 {color: #000000; -webkit-text-stroke: 0px #000000}
    span.s7 {text-decoration: underline ; font-kerning: none}
    span.s8 {text-decoration: underline}
    span.s9 {font: 12.0px Helvetica}
    span.Apple-tab-span {white-space:pre}
    ol.ol1 {list-style-type: decimal}
  </style>
</head>
<body>
<div style="width: 600px; margin: 0 auto">

<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Introduction</b></h2>
<p class="p2">In this essay, I show the very basics of transpiling a diagram to code.</p>
<p class="p3"><br></p>
<p class="p2">I call this DaS - <i>Diagrams</i> <i>as Syntax.</i></p>
<p class="p3"><br></p>
<p class="p2">If you want to follow along, see Appendix - Getting Started.</p>
<p class="p3"><br></p>
<p class="p2">There's nothing new here - just a combination of already-existing technologies.</p>
<p class="p3"><br></p>
<p class="p2">This should look ridiculously simple. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">You should find yourself yawning through most of this. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">If it doesn't seem simple enough, I haven't done my job well. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">I am happy to answer questions.</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>A Simple Diagram</b></h2>
<p class="p4"><span class="s1">See </span>simple.drawio<span class="s1">.</span></p>
<p class="p3"><br></p>
<p class="p2">We see a very simple diagram on Tab 101.</p>
<p class="p3"><br></p>
<p class="p2">The diagram consists of two boxes, joined by an arrow.</p>
<p class="p3"><br></p>
<p class="p2"><img src="/assets/2021-01-12-17-29-39-Images/simple.png" width="361px" height="61px" alt="Image"></p>
<p class="p3"><br></p>
<p class="p2">We will:</p>
<ol class="ol1">
  <li class="li5">convert this diagram to text, from .drawio to .xml format</li>
  <li class="li5">convert the .XML to a JavaScript object</li>
  <li class="li5">extract the interesting stuff from the object, and leave the rest behind ("syntactic noise")</li>
  <li class="li5">normalize the interesting stuff into a <i>factbase</i></li>
  <li class="li5">normalize the graphics - glean bounding boxes for every box</li>
  <li class="li5">stop (that's enough for lesson 101).</li>
</ol>
<p class="p6"><br></p>
<p class="p5">We will do a lot of this manually. <span class="Apple-converted-space"> </span></p>
<p class="p6"><br></p>
<p class="p5">We can do all of this with just a text editor.</p>
<p class="p6"><br></p>
<p class="p5">I will suggest technologies (from direct experience) that automate the boring, repetitive edits.<span class="Apple-converted-space">  </span>My goal is to automate everything and not to have to use an editor.</p>
<p class="p6"><br></p>
<p class="p6"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Transpilation</b></h2>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Convert the Diagram to Text</b></h2>
<p class="p2">Load the diagram <span class="s2">simple.drawio</span> into a programmers' text editor.</p>
<p class="p3"><br></p>
<p class="p2">You should see a header (mxfile host="Electron"…) followed by at least one <span class="s2">&lt;diagram&gt;…&lt;/diagram&gt;</span> in compressed form.</p>
<p class="p3"><br></p>
<p class="p2">Copy the compressed stuff inside of the &lt;diagram&gt; element (zZRNT…A==) and paste it into the drawio diagram decoder <a href="https://jgraph.github.io/drawio-tools/tools/convert.html"><span class="s3">https://jgraph.github.io/drawio-tools/tools/convert.html</span></a><span class="s3">.</span></p>
<p class="p7"><span class="s4"></span><br></p>
<p class="p8"><span class="s4">Hit the <i>decode</i> button (at the bottom).</span></p>
<p class="p9"><span class="s4"></span><br></p>
<p class="p10"><span class="s5">You should see human-readable XML, e.g. </span><span class="s6">&lt;mxGraphModel … &gt; … &lt;/mxGraphModel&gt;</span><span class="s5">.</span></p>
<p class="p9"><span class="s4"></span><br></p>
<p class="p8"><span class="s4">Copy the XML and paste it into a local file.</span></p>
<p class="p9"><span class="s4"></span><br></p>
<p class="p10"><span class="s5">I saved my copy in </span><span class="s6">decoded.xml</span><span class="s5">.</span></p>
<p class="p11"><span class="s4"></span><br></p>
<p class="p12"><span class="s7">Further reading:<span class="Apple-converted-space"> </span></span></p>
<p class="p12"><span class="s4"><a href="https://drawio-app.com/extracting-the-xml-from-mxfiles/">https://drawio-app.com/extracting-the-xml-from-mxfiles/</a></span></p>
<p class="p12"><span class="s4"><a href="https://jgraph.github.io/mxgraph/docs/manual.html">https://jgraph.github.io/mxgraph/docs/manual.html</a></span></p>
<p class="p13"><span class="s4"></span><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Convert XML to JS</b></h2>
<p class="p2">The XML for our diagram is contained in the <span class="s2">&lt;root&gt;…&lt;/root&gt;</span> element.</p>
<p class="p3"><br></p>
<p class="p14"><span class="Apple-converted-space">    </span>&lt;mxCell id="0"/&gt;</p>
<p class="p14"><span class="Apple-converted-space">    </span>&lt;mxCell id="1" parent="0"/&gt;</p>
<p class="p14"><span class="Apple-converted-space">    </span>&lt;mxCell id="irZAPYOEPGDIWvvxZr80-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="irZAPYOEPGDIWvvxZr80-2" target="irZAPYOEPGDIWvvxZr80-3" edge="1"&gt;</p>
<p class="p14"><span class="Apple-converted-space">      </span>&lt;mxGeometry relative="1" as="geometry"/&gt;</p>
<p class="p14"><span class="Apple-converted-space">    </span>&lt;/mxCell&gt;</p>
<p class="p14"><span class="Apple-converted-space">    </span>&lt;mxCell id="irZAPYOEPGDIWvvxZr80-2" value="Box 1" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1"&gt;</p>
<p class="p14"><span class="Apple-converted-space">      </span>&lt;mxGeometry x="40" y="120" width="120" height="60" as="geometry"/&gt;</p>
<p class="p14"><span class="Apple-converted-space">    </span>&lt;/mxCell&gt;</p>
<p class="p14"><span class="Apple-converted-space">    </span>&lt;mxCell id="irZAPYOEPGDIWvvxZr80-3" value="Box 2" style="rounded=1;whiteSpace=wrap;html=1;align=center;" parent="1" vertex="1"&gt;</p>
<p class="p14"><span class="Apple-converted-space">      </span>&lt;mxGeometry x="280" y="120" width="120" height="60" as="geometry"/&gt;</p>
<p class="p14"><span class="Apple-converted-space">    </span>&lt;/mxCell&gt;</p>
<p class="p15"><br></p>
<p class="p2">This can be converted using an editor (yawn), into Javascript:</p>
<p class="p15"><br></p>
<p class="p14">const graphModel =<span class="Apple-converted-space"> </span></p>
<p class="p14">{ element: "mxGraphModel",</p>
<p class="p14"><span class="Apple-converted-space">  </span>dx: 940,</p>
<p class="p14"><span class="Apple-converted-space">  </span>dy: 670,</p>
<p class="p14"><span class="Apple-converted-space">  </span>grid: 1,</p>
<p class="p14"><span class="Apple-converted-space">  </span>gridSize: 10,</p>
<p class="p14"><span class="Apple-converted-space">  </span>guides: 1,</p>
<p class="p14"><span class="Apple-converted-space">  </span>tooltips: 1,</p>
<p class="p14"><span class="Apple-converted-space">  </span>connect: 1,</p>
<p class="p14"><span class="Apple-converted-space">  </span>arrows: 1,</p>
<p class="p14"><span class="Apple-converted-space">  </span>fold: 1,</p>
<p class="p14"><span class="Apple-converted-space">  </span>page: 1,</p>
<p class="p14"><span class="Apple-converted-space">  </span>pageScale: 1,</p>
<p class="p14"><span class="Apple-converted-space">  </span>pageWidth: 1100,</p>
<p class="p14"><span class="Apple-converted-space">  </span>pageHeight: 850,</p>
<p class="p14"><span class="Apple-converted-space">  </span>math: 0,</p>
<p class="p14"><span class="Apple-converted-space">  </span>shadow: 0,</p>
<p class="p14"><span class="Apple-converted-space">  </span>root: [</p>
<p class="p14"><span class="Apple-converted-space">      </span>{ element: "mxCell",</p>
<p class="p14"><span class="Apple-converted-space">        </span>id: "yqBiCKyfxECIX-FCSyxT-0",</p>
<p class="p14"><span class="Apple-converted-space">      </span>},</p>
<p class="p14"><span class="Apple-converted-space">      </span>{ element: "mxCell",</p>
<p class="p14"><span class="Apple-tab-span">	</span>id: "yqBiCKyfxECIX-FCSyxT-1",</p>
<p class="p14"><span class="Apple-tab-span">	</span>parent: "yqBiCKyfxECIX-FCSyxT-0"</p>
<p class="p14"><span class="Apple-converted-space">      </span>},</p>
<p class="p14"><span class="Apple-converted-space">      </span>{ element: "mxCell",</p>
<p class="p14"><span class="Apple-tab-span">	</span>id: "yqBiCKyfxECIX-FCSyxT-4",</p>
<p class="p14"><span class="Apple-tab-span">	</span>style: "edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;",</p>
<p class="p14"><span class="Apple-converted-space">        </span>edge: "1",</p>
<p class="p14"><span class="Apple-tab-span">	</span>parent: "yqBiCKyfxECIX-FCSyxT-1",</p>
<p class="p14"><span class="Apple-tab-span">	</span>source: "yqBiCKyfxECIX-FCSyxT-2",</p>
<p class="p14"><span class="Apple-tab-span">	</span>target: "yqBiCKyfxECIX-FCSyxT-3",</p>
<p class="p14"><span class="Apple-tab-span">	</span>content: {</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span>element: "mxGeometry",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span>relative: "1",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span>as: "geometry"</p>
<p class="p14"><span class="Apple-tab-span">	</span>}</p>
<p class="p14"><span class="Apple-converted-space">      </span>},</p>
<p class="p14"><span class="Apple-converted-space">      </span>{</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>element : "mxCell",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>id: "yqBiCKyfxECIX-FCSyxT-2",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>value: "Box 1",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>style: "rounded=1;whiteSpace=wrap;html=1;align=center;",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>vertex: "1",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>parent: "yqBiCKyfxECIX-FCSyxT-1",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>content: {</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>element: "mxGeometry",<span class="Apple-converted-space"> </span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>x: "40",<span class="Apple-converted-space"> </span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>y: "120",<span class="Apple-converted-space"> </span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>width: "120",<span class="Apple-converted-space"> </span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>height: "60",<span class="Apple-converted-space"> </span></p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>as: "geometry"</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>}</p>
<p class="p14"><span class="Apple-converted-space">      </span>},</p>
<p class="p14"><span class="Apple-converted-space">      </span>{</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>element: "mxCell",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>id: "yqBiCKyfxECIX-FCSyxT-3",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>value: "Box 2",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>style: "rounded=1;whiteSpace=wrap;html=1;align=center;",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>vertex: "1",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>parent: "yqBiCKyfxECIX-FCSyxT-1",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>content: {</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>element: "mxGeometry",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>x: "280",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>y: "120",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>width: "120",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>height: "60",</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>as: "geometry"</p>
<p class="p14"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">  </span>}</p>
<p class="p14"><span class="Apple-converted-space">      </span>}</p>
<p class="p14"><span class="Apple-converted-space">  </span>]</p>
<p class="p14">};</p>
<p class="p15"><br></p>
<p class="p2">I stored the converted file in <span class="s2">graphmodel.js</span>.</p>
<p class="p3"><br></p>
<p class="p2"><span class="s8">Further reading:</span></p>
<p class="p3"><br></p>
<p class="p2">The conversion from XML to JS can be done automatically. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">This <span class="s8">looks</span> like a job for REGEXP, but it isn't. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">REGEXP creates a <i>finite automata</i>, but we need a <i>pushdown finite automata</i>.</p>
<p class="p3"><br></p>
<p class="p2">This is a job for [<i>rip open shirt:</i>] <span class="s8">PEG</span> - Parsing Expression Grammars. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">Don't worry about the fancy name - this stuff is as simple to use as REGEXP, but better.</p>
<p class="p3"><br></p>
<p class="p2">We should be able to write a <i>grammar</i> (pattern match) for the mxGraphModel XML and a set of <i>semantics </i>(i.e. code) that returns a Javascript object.</p>
<p class="p3"><br></p>
<p class="p2">There are a lot of implementations of PEG for various languages.<span class="Apple-converted-space">  </span>I happen to use Ohm-js when I use Javascript and ESRAP when I use Common Lisp.<span class="Apple-converted-space">  </span>REBOL's <i>parse</i> is PEG-like.</p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Interesting Stuff</b></h2>
<p class="p2">The graph model contains mostly 2D graphics information.</p>
<p class="p3"><br></p>
<p class="p2">We can skip most of it.</p>
<p class="p3"><br></p>
<p class="p2">We just want to know what the boxes are and what the arrows are.</p>
<p class="p3"><br></p>
<p class="p2">We want to know <i>where</i> the boxes and arrows are.</p>
<p class="p3"><br></p>
<p class="p2">We want to know what boxes are connected by arrows.<span class="Apple-converted-space">  </span>The source box and the target box.</p>
<p class="p3"><br></p>
<p class="p2">We, probably, want to remember the parent/child relationships of these graphical entities.</p>
<p class="p3"><br></p>
<p class="p2">Note that we are discussing DaS (<i>diagrams as syntax</i>). <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">Many people confabulate the notion of <i>visual programming</i> with understanding pixels.</p>
<p class="p3"><br></p>
<p class="p2">We don't want to go as deep.<span class="Apple-converted-space">  </span>We don't care about pixels.</p>
<p class="p3"><br></p>
<p class="p2">We only want to add a few items to our grab-bag - boxes, arrows, text.</p>
<p class="p3"><br></p>
<p class="p2">We will want to store this "want to know" stuff in some sort of data thingie - a database, a data structure, or something even easier.</p>
<p class="p3"><br></p>
<p class="p2">I favour the idea of <span class="s8">factbases</span> instead of using heavy-weight concepts like databases and data structures.</p>
<p class="p3"><br></p>
<p class="p2">I will diverge, momentarily, on a discussion of factbases.</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Factbases</b></h2>
<p class="p2">The <i>trick</i> to automating anything in software is to find a way to <i>normalize </i>the information.</p>
<p class="p3"><br></p>
<p class="p2">We discovered how to normalize code very early on - we used a notation called <i>assembler</i>.</p>
<p class="p3"><br></p>
<p class="p2">Assembler is code represented as triples - relation, subject, object.</p>
<p class="p3"><br></p>
<p class="p2">For example</p>
<p class="p3"><br></p>
<p class="p4">MOV R0, R1</p>
<p class="p16"><br></p>
<p class="p2">is a triple.<span class="Apple-converted-space">  </span>The relation is MOV.<span class="Apple-converted-space">  </span>The subject is R0.<span class="Apple-converted-space">  </span>The object is R1.</p>
<p class="p3"><br></p>
<p class="p2">If the idea of <i>triples</i> sounds familiar, it's because you've already heard of it.</p>
<p class="p3"><br></p>
<p class="p2">XML is triples<a id="fnlink1"></a><a href="#fn1"><sup>[1]</sup></a>.<span class="Apple-converted-space">  </span>The Semantic Web is triples.</p>
<p class="p3"><br></p>
<p class="p2">So, what is the <i>normalized</i> format of data?</p>
<p class="p3"><br></p>
<p class="p2">Triples!</p>
<p class="p3"><br></p>
<p class="p2">We want to put data into the form: relation, subject, object.</p>
<p class="p3"><br></p>
<p class="p2">Conveniently, this already exists.<span class="Apple-converted-space">  </span>It is a function of two parameters:</p>
<p class="p3"><br></p>
<p class="p14">relation(subject,object);</p>
<p class="p15"><br></p>
<p class="p2">or,<span class="Apple-converted-space"> </span></p>
<p class="p15"><br></p>
<p class="p14">fn(id,x);</p>
<p class="p15"><br></p>
<p class="p2">Why is this a <i>Good Thing</i>? <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">Well, because we impose <b>no</b> structure on the data. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">If the data has no structure, then it is easy to parse (in an automatic manner). <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">If the data has no structure, then it can be used for other kinds of things.<span class="Apple-converted-space">  </span>Things that the original programmer never thought of.</p>
<p class="p3"><br></p>
<p class="p2">Note that organizing data into a data structure at compile time is just an optimization.<span class="Apple-converted-space">  </span>In the 1950's, it seemed like a good idea to preserve CPU power by pre-compiling data into data structures.</p>
<p class="p3"><br></p>
<p class="p2">Today, CPUs are cheap and abundant, we can waste CPU time building data structures at runtime.<span class="Apple-converted-space">  </span>We don't have to worry about pre-compiling things.</p>
<p class="p3"><br></p>
<p class="p2">How shall we waste CPU time? <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">By performing exhaustive search.</p>
<p class="p3"><br></p>
<p class="p2">By using backtracking.<span class="Apple-converted-space">  </span>Backtracking was <i>verbotten</i> in the 1900's, but no more.</p>
<p class="p3"><br></p>
<p class="p2">I know, from experience, that I will be using PROLOG for doing exhaustive search.<span class="Apple-converted-space">  </span>So, I will put a period ('.') at the end of each function and call this a <i>fact</i>.</p>
<p class="p3"><br></p>
<p class="p14">fn(id,x).</p>
<p class="p15"><br></p>
<p class="p2">Caution: use the principles of Shuhari here.</p>
<p class="p3"><br></p>
<p class="p2">Shu: don't expand the definition of "x" in the above.<span class="Apple-converted-space">  </span>It is one thing and one thing only.</p>
<p class="p3"><br></p>
<p class="p2">For example, imagine that I have a rectangle R, with top-left (<i>x,y</i>) and a width, <i>w</i>, and a height, <i>h</i>.</p>
<p class="p3"><br></p>
<p class="p2">In factbase notation, this becomes</p>
<p class="p3"><br></p>
<p class="p14">rectangle(<i>R</i>,<i>nil</i>).</p>
<p class="p14">top_x(<i>R</i>,<i>x</i>).</p>
<p class="p14">top_y(<i>R</i>,<i>y</i>).</p>
<p class="p14">width(<i>R</i>,<i>w</i>).</p>
<p class="p14">height(<i>R</i>,<i>h</i>).</p>
<p class="p3"><br></p>
<p class="p2">Resist the urge to do something like:</p>
<p class="p3"><br></p>
<p class="p14">rectangle(<i>R</i>,[<i>x,y,w,h</i>]).</p>
<p class="p3"><br></p>
<p class="p2">or</p>
<p class="p3"><br></p>
<p class="p14">rectangle(<i>R</i>,nil).</p>
<p class="p14">top(<i>R</i>,[<i>x,y</i>]).</p>
<p class="p14">wh(<i>R</i>,[<i>w,h</i>]).</p>
<p class="p3"><br></p>
<p class="p2">We will use CPU power<a id="fnlink2"></a><a href="#fn2"><sup>[2]</sup></a> to glean various relationships about the data.<span class="Apple-converted-space">  </span>In fact, one of the first relationships will be to create a <i>bounding box</i> for each rectangle (we will see this later).</p>
<p class="p3"><br></p>
<p class="p2">CPU is cheap.</p>
<p class="p3"><br></p>
<p class="p2">Memory is cheap.</p>
<p class="p3"><br></p>
<p class="p2">Don't waste brain power.</p>
<p class="p3"><br></p>
<p class="p2">Don't try to predict the various ways in which data will be structured.<a id="fnlink3"></a><a href="#fn3"><sup>[3]</sup></a></p>
<p class="p3"><br></p>
<p class="p2">PROLOG already knows how to deal with triples of the above form. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">PROLOG knows how to search triples. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">You know how to search triples (loops within loops within …). <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">It gets boring after a while. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">When it gets boring, automate.</p>
<p class="p3"><br></p>
<p class="p2">Automation done before you know what you're doing is called <i>premature optimization</i>.</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p2">It is best to grow the factbase with new facts, rather than culling facts from the factbase.<span class="Apple-converted-space">  </span>This allows maximum flexibility during design.<span class="Apple-converted-space">  </span>Culling is just an optimization and should be left to Optimization Engineering.</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p2"><span class="s8">Recap:</span></p>
<p class="p3"><br></p>
<p class="p2">Code is normalized into triples, e.g. <span class="s2">MOV R0,R1</span>.</p>
<p class="p3"><br></p>
<p class="p2">Data is normalized into triples, e.g. <span class="s2">top_x(<i>R,x</i>)</span><i>.</i></p>
<p class="p3"><i></i><br></p>
<p class="p2"><i>Factbases </i>are the normalized (triple-ified) form of data.</p>
<p class="p3"><br></p>
<p class="p2"><span class="s8">Further Reading:</span></p>
<p class="p2">see the Appendix for tools like gprolog, JS prolog, miniKanren, AWK.</p>
<p class="p3"><i></i><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Normalize - Create a Factbase</b></h2>
<p class="p2"><span class="Apple-converted-space">  </span>Now that we know what a factbase is, we will see it in action.</p>
<p class="p3"><br></p>
<p class="p2">Yawn.</p>
<p class="p3"><br></p>
<p class="p2">Look at <span class="s2">main.js</span>.<span class="Apple-converted-space">  </span>It contains the following code:</p>
<p class="p3"><br></p>
<p class="p14"><span class="Apple-converted-space">      </span>…</p>
<p class="p14"><span class="Apple-tab-span">	</span>createParentFact (element);</p>
<p class="p14"><span class="Apple-tab-span">	</span>createNameFact (element);</p>
<p class="p14"><span class="Apple-tab-span">	</span>createArrowFact (element);</p>
<p class="p14"><span class="Apple-tab-span">	</span>createRectFact (element);</p>
<p class="p14"><span class="Apple-converted-space">      </span>…</p>
<p class="p15"><br></p>
<p class="p2">It appears that we are interested in only 4 things - and we throw away the rest of the graphical details.<span class="Apple-converted-space">  </span>[<i>Later, we will deal with text inside of boxes and stuff like that.</i>]</p>
<p class="p3"><br></p>
<p class="p2">We need to write a bit of - very easy - JS code to extract the interesting information.</p>
<p class="p3"><br></p>
<p class="p2">We can look at the file <span class="s2">facts.js</span> to see how I chose to implement the extraction.<span class="Apple-converted-space">  </span>YMMV.<a id="fnlink4"></a><a href="#fn4"><sup>[4]</sup></a><span class="Apple-converted-space">  </span>Yawn.</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Bounding Boxes</b></h2>
<p class="p2">Now, we want to do something with the factbase and the graphical items</p>
<p class="p3"><br></p>
<p class="p2">We want to do as little as possible.</p>
<p class="p3"><br></p>
<p class="p2">Then, we want to wrap and isolate that bit and never have to think about it again.<a id="fnlink5"></a><a href="#fn5"><sup>[5]</sup></a></p>
<p class="p3"><br></p>
<p class="p2">The first step in transpiling a diagram is to normalize all of the data.<span class="Apple-converted-space">  </span>This will allow us to create more-and-more interesting interpretations of the data.</p>
<p class="p3"><br></p>
<p class="p2">I have put the factbase into a form that is acceptable to PROLOG.<span class="Apple-converted-space">  </span>YMMV.<span class="Apple-converted-space">  </span>I use PROLOG to do exhaustive searches.<span class="Apple-converted-space">  </span>You might want to use something else, like miniKanren (core.logic in Clojure-speak) or just loops within loops in your favourite language.</p>
<p class="p3"><br></p>
<p class="p2">[<i>I have created a PROLOG for Javascript using Nils Holm's Prolog Control In 6 Slides".<span class="Apple-converted-space">  </span>See the appendix.<span class="Apple-converted-space">  </span>This was an exercise in transpiling from one language to another using PEG - Scheme to JS using ohm-js.]</i>.</p>
<p class="p3"><br></p>
<p class="p2">My exhaustive search, written in gprolog, is:</p>
<p class="p3"><br></p>
<p class="p14">% calculate_bounding_boxes :-</p>
<p class="p14">bb(ID,Left,Top,Right,Bottom) :-</p>
<p class="p14"><span class="Apple-converted-space">    </span>x(ID, X),</p>
<p class="p14"><span class="Apple-converted-space">    </span>y(ID, Y),</p>
<p class="p14"><span class="Apple-converted-space">    </span>width(ID,W),</p>
<p class="p14"><span class="Apple-converted-space">    </span>height(ID,H),</p>
<p class="p14"><span class="Apple-converted-space">    </span>Left is X,</p>
<p class="p14"><span class="Apple-converted-space">    </span>Top is Y,</p>
<p class="p14"><span class="Apple-converted-space">    </span>Right is X + W,</p>
<p class="p14"><span class="Apple-converted-space">    </span>Bottom is Y + H.</p>
<p class="p15"><br></p>
<p class="p2">In Prolog, identifiers that begin with a capital letter are "logic variables" - basically holes that get filled in by the exhaustive search engine.<span class="Apple-converted-space">  </span>Everything else begins with a lower-case letter.<span class="Apple-converted-space">  </span>I could have cut out half of the code, but I wanted to be excruciatingly clear.</p>
<p class="p3"><br></p>
<p class="p2">This says:</p>
<p class="p3"><br></p>
<p class="p14">match any ID that has an X value</p>
<p class="p14"><span class="Apple-converted-space">  </span>and</p>
<p class="p14">has a Y value</p>
<p class="p14"><span class="Apple-converted-space">   </span>and</p>
<p class="p14">has a width value</p>
<p class="p14"><span class="Apple-converted-space">  </span>and</p>
<p class="p14">has a height value</p>
<p class="p14"><span class="Apple-converted-space">  </span>then</p>
<p class="p14">calculate the Left/Top/Right/Bottom values of the bounding box and leave these values in the logic variables Left, Top, Right and Bottom.</p>
<p class="p3"><br></p>
<p class="p2">Clearly, we could have done this using Loops (recursion) in our favourite language, but the code would not have been so concise.</p>
<p class="p3"><br></p>
<p class="p2">Another PROLOG file - <span class="s2">main.pl</span> - uses the <span class="s2">forall</span> function of PROLOG to perform the search over-and-over again and performs the magic incantations to output the results as new facts for the factbase.</p>
<p class="p3"><br></p>
<p class="p2">Specifically, the new facts are poured out into <span class="s2">stderr </span>where the new facts are glued onto the input factbase as the result.<a id="fnlink6"></a><a href="#fn6"><sup>[6]</sup></a></p>
<p class="p3"><span class="Apple-converted-space"> </span></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Stop</b></h2>
<p class="p2">I will stop "Transpiling Diagrams to Code 101" here.<span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">I will expand, later.</p>
<p class="p3"><br></p>
<p class="p2">I hope that the basics have been easy to understand and to riff on, after one goes beyond the Shu and Ha phases of Shuhari.</p>
<p class="p3"><br></p>
<p class="p2">There's nothing new here - just a combination of already-existing technologies.</p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Appendix - Getting Started</b></h2>
<p class="p2">0. Get the code …</p>
<p class="p2">1. Get Ohm-js from <a href="https://github.com/harc/ohm"><span class="s2">https://github.com/harc/ohm</span></a><span class="s2"> </span>and install it alongside of this code.</p>
<p class="p2">2. Examine and run <span class="s2">run.bash</span>.</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Appendix - Automation</b></h2>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Decoding DRAWIO Files</b></h2>
<p class="p2">The code for the decoder is: <a href="https://github.com/jgraph/drawio-tools">https://github.com/jgraph/drawio-tools</a>.</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p2">We should be able to decode .drawio files using Javascript.</p>
<p class="p3"><br></p>
<p class="p2">At time of writing, I haven't figured out how to do this using, say, node.js.<span class="Apple-converted-space">  </span>Suggestions welcome.</p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Converting mxGraphModel to JavaScript</b></h2>
<p class="p2">Use PEG to pattern-match the xml and then emit it (a <i>semantic </i>action)<a id="fnlink7"></a><a href="#fn7"><sup>[7]</sup></a> as Javascript.</p>
<p class="p3"><br></p>
<p class="p2">I expect to write about this transformation step in later essays.</p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Appendix - Tools</b></h2>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>PEG - Ohm In Small Steps</b></h2>
<p class="p2">Everyone knows how to use REGEXP.</p>
<p class="p3"><br></p>
<p class="p2">PEG is better than REGEXP.</p>
<p class="p3"><br></p>
<p class="p2">Use PEG instead of REGEXP.</p>
<p class="p3"><br></p>
<p class="p2"><a href="https://computingsimplicity.neocities.org/blogs/OhmInSmallSteps.pdf">https://computingsimplicity.neocities.org/blogs/OhmInSmallSteps.pdf</a></p>
<p class="p3"><br></p>
<p class="p2"><a href="https://guitarvydas.github.io/2020/12/09/OhmInSmallSteps.html">https://guitarvydas.github.io/2020/12/09/OhmInSmallSteps.html</a></p>
<p class="p2">(the HTML version doesn't have page numbers.)</p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>PEG</b></h2>
<p class="p2"><a href="https://bford.info/pub/lang/peg/">https://bford.info/pub/lang/peg/</a></p>
<p class="p3"><br></p>
<p class="p2">Ohm-js: (PEG for Javascript)</p>
<p class="p2"><a href="https://github.com/harc/ohm">https://github.com/harc/ohm</a></p>
<p class="p3"><br></p>
<p class="p2">ESRAP: (PEG for Common Lisp)</p>
<p class="p2"><a href="https://github.com/scymtym/esrap">https://github.com/scymtym/esrap</a></p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>GProlog</b></h2>
<p class="p2">PROLOG ain't scary.</p>
<p class="p3"><br></p>
<p class="p2">PROLOG is just a pattern matcher.</p>
<p class="p3"><br></p>
<p class="p2">PROLOG has a convenient syntax for pattern matching.<span class="Apple-converted-space">  </span>Identifiers that begin with an upper-case letter are "logic variables" - i.e. match-capturing doo-dads.<span class="Apple-converted-space">  </span>Everything else begins with lower-case letters.</p>
<p class="p3"><br></p>
<p class="p2">REGEXP uses a horrible syntax for match-capturing - e.g. '\(…\)'.<span class="Apple-converted-space">  </span>PROLOG uses a less-horrible syntax for this. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">REGEXP works on characters.<span class="Apple-converted-space">  </span>PROLOG works on higher-level things.</p>
<p class="p3"><br></p>
<p class="p2">PROLOG becomes scary if you try to use it for <i>everything</i>.<span class="Apple-converted-space">  </span>A single paradigm does not suit all problems, nor all parts of a problem.<span class="Apple-converted-space">  </span>Get into the habit of using many paradigms for a single solution<a id="fnlink8"></a><a href="#fn8"><sup>[8]</sup></a>.<span class="Apple-converted-space">  </span>Get into the habit of building many little languages for a single solution.<span class="Apple-converted-space">  </span>(I call these SCLs - Solution Centric Languages.<span class="Apple-converted-space">  </span>SCLs are like DSLs, but more focussed and less hassle to build (if you use PEGs)).</p>
<p class="p3"><br></p>
<p class="p2"><a href="http://www.gprolog.org/">http://www.gprolog.org/</a></p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>JS Prolog</b></h2>
<p class="p2"><a href="https://github.com/guitarvydas/js-match">https://github.com/guitarvydas/js-match</a></p>
<p class="p3"><br></p>
<p class="p2"><a href="https://github.com/guitarvydas/js-prolog">https://github.com/guitarvydas/js-prolog</a></p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>miniKanren</b></h2>
<p class="p2"><a href="http://minikanren.org">http://minikanren.org</a></p>
<p class="p3"><br></p>
<p class="p2">(In Clojure, this is called core.logic).</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>AWK</b></h2>
<p class="p2"><a href="https://en.wikipedia.org/wiki/AWK">https://en.wikipedia.org/wiki/AWK</a></p>
<p class="p3"><br></p>
<p class="p2"><a href="https://www.gnu.org/software/gawk/manual/gawk.html">https://www.gnu.org/software/gawk/manual/gawk.html</a></p>
<p class="p3"><br></p>
<p class="p2">I first used AWK to build a peephole optimizer for a C compiler I wrote (around 1980/1981).</p>
<p class="p3"><br></p>
<p class="p2">The C code produced normalized code - aka assembler.</p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Nils Holm PROLOG</b></h2>
<p class="p2"><a href="https://www.t3x.org/bits/prolog6.html">https://www.t3x.org/bits/prolog6.html</a></p>
<p class="p3"><br></p>
<p class="p2">I used Nils' Scheme code and converted it into Javascript using PEG (ohm-js).</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Appendix - Documentation</b></h2>
<p class="p12"><span class="s4">Drawio decoder:</span></p>
<p class="p12"><span class="s4"><a href="https://drawio-app.com/extracting-the-xml-from-mxfiles/">https://drawio-app.com/extracting-the-xml-from-mxfiles/</a></span></p>
<p class="p7"><span class="s4"></span><br></p>
<p class="p12"><span class="s4">MxGraph User Manual:</span></p>
<p class="p12"><span class="s4"><a href="https://jgraph.github.io/mxgraph/docs/manual.html">https://jgraph.github.io/mxgraph/docs/manual.html</a></span></p>
<p class="p17"><br></p>
<hr>
<p class="p18"><a id="fn1"></a><a href="#fnlink1"><span class="s1">[1]</span></a><span class="s1"> </span>XML has too much syntax to be easily readable.</p>
<p class="p18"><a id="fn2"></a><a href="#fnlink2"><span class="s1">[2]</span></a><span class="s1"> exhaustive search</span></p>
<p class="p18"><span class="s1"><a id="fn3"></a><a href="#fnlink3">[3]</a> </span>Only tyrants tell you what to think.<span class="Apple-converted-space">  </span>Be free.<span class="Apple-converted-space">  </span>Let others be free.</p>
<p class="p18"><a id="fn4"></a><a href="#fnlink4"><span class="s1">[4]</span></a><span class="s1"> </span>YMMV means Your Mileage Might Vary.<span class="Apple-converted-space">  </span>It means this even in metric countries.</p>
<p class="p5"><span class="s9"><a id="fn5"></a><a href="#fnlink5"><span class="s1">[5]</span></a></span> That's called <i>The Principle of Superposition.</i> <span class="Apple-converted-space"> </span></p>
<p class="p6"><br></p>
<p class="p5"><i>Superposition is taught in other Engineering disciplines.<span class="Apple-converted-space">  </span>I learned about it in EE school, tangled up with Kirchoff's Laws.<span class="Apple-converted-space">  </span>Superposition makes EE a lot easier to design, even though everything in a circuit is concurrent.<span class="Apple-converted-space">  </span>The last time I saw Superposition at work in software was when I looked at a bash script</i>.</p>
<p class="p18"><span class="s1"><a id="fn6"></a><a href="#fnlink6">[6]</a> </span>Obviously, we could use a language that helped us add facts to the input factbase.<span class="Apple-converted-space">  </span>I haven't figured out how to do this easily in PROLOG.<span class="Apple-converted-space">  </span>But, why would I care?<span class="Apple-converted-space">  </span>I can leave the cleanup to someone who specializes in Maintenance Engineering. [I have figured out how to do this not-so-easily in PROLOG, but it ain't pretty, see https://github.com/bmfbp/bmfbp].</p>
<p class="p5"><span class="s9"><a id="fn7"></a><a href="#fnlink7"><span class="s1">[7]</span></a></span> Semantic action is just a fancy word that you may ignore.<span class="Apple-converted-space">  </span>In ohm-js, a semantic action is a lump of Javascript that where pattern-matching-capture is passed in as function parameters.</p>
<p class="p18"><span class="s1"><a id="fn8"></a><a href="#fnlink8">[8]</a> </span>Lispers "get" this idea.<span class="Apple-converted-space">  </span>That's why they love Lisp and the freedom of thought that it brings.<span class="Apple-converted-space">  </span>Javascript comes close (first-class functions, dynamic typing).<span class="Apple-converted-space">  </span>Static typing is just a DSL that uses dynamic typing and pushes all of the interpretation of types to the so-called "compile time".<span class="Apple-converted-space">  </span>"Compile time" is an arbitrary concept (e.g. loaders finalize code at the beginning of runtime, even when static typing is used).</p>
</div>
</body>
</html>
