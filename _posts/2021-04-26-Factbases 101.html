<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Factbases 101</title>
  <meta name="CreationTime" content="2021-04-26T12:11:30Z">
  <meta name="ModificationTime" content="2021-04-26T12:11:30Z">
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1894.6">
  <style type="text/css">
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 13.0px Palatino}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 13.0px Palatino; min-height: 18.0px}
    p.p4 {margin: 0.0px 0.0px 0.0px 36.0px; font: 11.0px Menlo}
    p.p5 {margin: 0.0px 0.0px 0.0px 36.0px; font: 11.0px Menlo; min-height: 13.0px}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino; min-height: 18.0px}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p10 {margin: 0.0px 0.0px 0.0px 36.0px; text-indent: -36.0px; font: 12.0px Helvetica}
    li.li6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino}
    span.s1 {font: 11.0px Menlo}
    span.s2 {text-decoration: underline}
    span.s3 {font: 13.0px Palatino}
    span.Apple-tab-span {white-space:pre}
    ol.ol1 {list-style-type: lower-alpha}
    ol.ol2 {list-style-type: decimal}
    ul.ul1 {list-style-type: disc}
  </style>
</head>
<body>
<div style="width: 600px; margin: 0 auto">

<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Introduction</b></h2>
<p class="p2">In this essay, I show two very simple factbases and their implementation in JavaScript, PROLOG and Lisp.</p>
<p class="p3"><br></p>
<p class="p2">Incidentally, the discussion shows how to begin compiling diagrams.</p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Factbase</b></h2>
<p class="p2">id1 is a rectangle.</p>
<p class="p3"><br></p>
<p class="p2">id1 is at (x,y) position (20,10).</p>
<p class="p3"><br></p>
<p class="p2">id1 has width 120.</p>
<p class="p3"><br></p>
<p class="p2">id1 has height 80.</p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Diagram</b></h2>
<p class="p2"><img src="/assets/2021-04-26-12-11-30-Images/Rectangles-OneRectangle.png" width="121px" height="81px" alt="Image"></p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Triples</b></h2>
<p class="p2">A triple is<span class="Apple-converted-space"> </span></p>
<p class="p4">relation (subject, object)</p>
<p class="p3"><br></p>
<p class="p2">no noise format:</p>
<p class="p3"><br></p>
<p class="p4">rectangle id1 null</p>
<p class="p4">x id1 20</p>
<p class="p4">y id1 10</p>
<p class="p4">width id1 120</p>
<p class="p4">height id1 80</p>
<p class="p5"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>JavaScript</b></h2>
<p class="p4">var id1 = {kind: "rect", x: 20, y: 10, width: 120, height: 80};</p>
<p class="p3"><br></p>
<p class="p2">or</p>
<p class="p3"><br></p>
<p class="p4">var fb = [{id: "id1", kind: "rect", x: 20, y: 10, width: 120, height: 80}];</p>
<p class="p3"><br></p>
<p class="p2">or</p>
<p class="p3"><br></p>
<p class="p4">var fb = [</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "rect", subject: "id1", object: null},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "x", subject: "id1", object: 20},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "y", subject: "id1", object: 10},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "width", subject: "id1", object: 120},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "height", subject: "id1", object: 80}</p>
<p class="p4">];</p>
<p class="p5"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>PROLOG</b></h2>
<p class="p4">rectangle(id1,nil).</p>
<p class="p4">x(id1,10).</p>
<p class="p4">y(id1,10).</p>
<p class="p4">width(id1,15).</p>
<p class="p4">height(id1,15).</p>
<p class="p5"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Lisp</b></h2>
<p class="p4">(rectangle id1 nil)</p>
<p class="p4">(x id1 10)</p>
<p class="p4">(y id1 10)</p>
<p class="p4">(width id1 15)</p>
<p class="p4">(height id1 15)</p>
<p class="p5"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Factbase With 2 Rectangles</b></h2>
<p class="p2">id1 is a rectangle.</p>
<p class="p3"><br></p>
<p class="p2">id1 is at (x,y) position (10,10).</p>
<p class="p3"><br></p>
<p class="p2">id1 has width 15.</p>
<p class="p3"><br></p>
<p class="p2">id1 has height 15.</p>
<p class="p3"><br></p>
<p class="p2">id2 is a rectangle.</p>
<p class="p3"><br></p>
<p class="p2">id2 is at (x,y) position (9,15).</p>
<p class="p3"><br></p>
<p class="p2">id2 has width 2.</p>
<p class="p3"><br></p>
<p class="p2">id2 has height 2.</p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Diagram</b></h2>
<p class="p2"><img src="/assets/2021-04-26-12-11-30-Images/Rectangles-TwoRectangles.png" width="131px" height="81px" alt="Image"></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Triples With 2 Rectangles</b></h2>
<p class="p4">rectangle id1 null</p>
<p class="p4">x id1 10</p>
<p class="p4">y id1 10</p>
<p class="p4">width id1 15</p>
<p class="p4">height id1 15</p>
<p class="p4">rectangle id2 null</p>
<p class="p4">x id2 9</p>
<p class="p4">y id2 15</p>
<p class="p4">width id2 2</p>
<p class="p4">height id2 2</p>
<p class="p5"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>JavaScript With 2 Rectangles</b></h2>
<p class="p4">var id1 = {kind: "rect", x: 10, y: 10, width: 15, height: 15};</p>
<p class="p4">var id2 = {kind: "rect", x: 9, y: 15, width: 2, height: 2};</p>
<p class="p3"><br></p>
<p class="p2">or</p>
<p class="p3"><br></p>
<p class="p4">var fb = [</p>
<p class="p4"><span class="Apple-converted-space">  </span>{id: "id1", kind: "rect", x: 10, y: 10, width: 15, height: 15},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{id: "id2", kind: "rect", x: 9, y: 15, width: 2, height: 2},</p>
<p class="p4">];</p>
<p class="p3"><br></p>
<p class="p2">or</p>
<p class="p3"><br></p>
<p class="p4">var fb = [</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "rect", subject: "id1", object: null},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "x", subject: "id1", object: 10},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "y", subject: "id1", object: 10},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "width", subject: "id1", object: 15},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "height", subject: "id1", object: 15}</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "rect", subject: "id2", object: null},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "x", subject: "id2", object: 9},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "y", subject: "id2", object: 15},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "width", subject: "id2", object: 2},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{relation: "height", subject: "id2", object: 2}</p>
<p class="p4">];</p>
<p class="p5"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>PROLOG With 2 Rectangles</b></h2>
<p class="p4">rectangle(id1,nil).</p>
<p class="p4">rectangle(id2,nil).</p>
<p class="p4">x(id1,20).</p>
<p class="p4">x(id2,10).</p>
<p class="p4">y(id1,10).</p>
<p class="p4">y(id2,40).</p>
<p class="p4">width(id1,120).</p>
<p class="p4">width(id2,20).</p>
<p class="p4">height(id1,80).</p>
<p class="p4">height(id2,20).</p>
<p class="p5"><br></p>
<p class="p2">In PROLOG, "or" relationships are most often written as multiple versions of a rule (PROLOG also has semi-colon syntax, but I won't discuss it here).</p>
<p class="p3"><br></p>
<p class="p2">PROLOG wants all rules with the same name, bunched together.</p>
<p class="p3"><br></p>
<p class="p2">UNIX® <i>sort</i> can be used to group rules together.</p>
<p class="p3"><br></p>
<p class="p2">The above factbase is sorted, e.g. all <span class="s1">rectangle</span> rules appear sequentially, all <span class="s1">width</span> rules appear sequentially, etc. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">There is no requirement about the order in which rules must appear (e.g <span class="s1">width</span> rules could appear before <span class="s1">rectangle</span> rules, and so on).<span class="Apple-converted-space">  </span>In the above example, sort has put rules in strict alphabetic order — this is not necessary, but is convenient (<span class="s1">sort</span> ensures that all rules are grouped together (required) <i>and </i><span class="s1">sort</span> ensures that groups appear in alphabetic order (not required, but there is no harm in accepting what <span class="s1">sort</span> does)).</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Lisp With 2 Rectangles</b></h2>
<p class="p4">(rectangle id1 nil)</p>
<p class="p4">(x id1 10)</p>
<p class="p4">(y id1 10)</p>
<p class="p4">(width id1 15)</p>
<p class="p4">(height id1 15)</p>
<p class="p4">(rectangle id2 nil)</p>
<p class="p4">(x id2 9)</p>
<p class="p4">(y id2 12)</p>
<p class="p4">(width id2 2)</p>
<p class="p4">(height id2 2)</p>
<p class="p5"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Obervations</b></h2>
<p class="p2">All forms encode the same information.</p>
<p class="p3"><br></p>
<p class="p2">JavaScript form 1 is human readable.</p>
<p class="p3"><br></p>
<p class="p2">The factbase form is less human readable (aka <i>ugly</i>).<span class="Apple-converted-space">  </span>E.G. JavaScript form 1 is more human-readable than JavaScript form 3.</p>
<p class="p3"><br></p>
<p class="p2">Q: which forms are easier to automate? (aka to <i>script</i>)</p>
<p class="p3"><br></p>
<p class="p2">sub-Q: which forms are more machine-readable?</p>
<p class="p3"><br></p>
<p class="p2">[<i>Keep these questions in mind as we look at some queries</i>]</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Queries</b></h2>
<p class="p6">[<i>We will deal only with the 2-rectangle factbases.</i>]</p>
<p class="p7"><br></p>
<p class="p6">Layer 0 queries:</p>
<ol class="ol1">
  <li class="li6">What id's are rectangles?</li>
  <li class="li6">Is rectangle id1 bigger than rectangle id2?</li>
  <li class="li6">Is rectangle id2 bigger than rectangle id1?</li>
  <li class="li6">Does id1 intersect id2?</li>
  <li class="li6">Does id2 intersect id1?</li>
</ol>
<p class="p3"><br></p>
<p class="p2">Answers:</p>
<ol class="ol1">
  <li class="li6">id1, id2</li>
  <li class="li6">yes</li>
  <li class="li6">no</li>
  <li class="li6">yes</li>
  <li class="li6">yes</li>
</ol>
<p class="p3"><br></p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Sub-Query - Bounding Boxes</b></h2>
<p class="p2">Answering query (d) and (e) is easier if we create a bounding box for all rectangles first.</p>
<p class="p3"><br></p>
<p class="p2">A bounding box is<span class="Apple-converted-space"> </span></p>
<ul class="ul1">
  <li class="li6">left x</li>
  <li class="li6">top y</li>
  <li class="li6">right x</li>
  <li class="li6">bottom y.</li>
</ul>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>JavaScript Queries</b></h2>
<p class="p5"><br></p>
<p class="p4">var id1 = {kind: "rect", x: 10, y: 10, width: 15, height: 15};</p>
<p class="p4">var id2 = {kind: "rect", x: 9, y: 15, width: 2, height: 2};</p>
<p class="p5"><br></p>
<p class="p4">answerA = [];</p>
<p class="p5"><br></p>
<p class="p4">if (id1.kind === "rect") {</p>
<p class="p4"><span class="Apple-converted-space">  </span>answerA.push (id1);</p>
<p class="p4">}</p>
<p class="p4">if (id2.kind === "rect") {</p>
<p class="p4"><span class="Apple-converted-space">  </span>answerA.push (id2);</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">//console.log (answerA);</p>
<p class="p5"><br></p>
<p class="p4">/////</p>
<p class="p5"><br></p>
<p class="p4">var id1 = {id: "id1", kind: "rect", x: 10, y: 10, width: 15, height: 15};</p>
<p class="p4">var id2 = {id: "id2", kind: "rect", x: 9, y: 15, width: 2, height: 2};</p>
<p class="p5"><br></p>
<p class="p4">answerAprimed = [];</p>
<p class="p5"><br></p>
<p class="p4">if (id1.kind === "rect") {</p>
<p class="p4"><span class="Apple-converted-space">  </span>answerAprimed.push (id1);</p>
<p class="p4">}</p>
<p class="p4">if (id2.kind === "rect") {</p>
<p class="p4"><span class="Apple-converted-space">  </span>answerAprimed.push (id2);</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">console.log (answerAprimed);</p>
<p class="p5"><br></p>
<p class="p4">for (r of answerAprimed) {</p>
<p class="p4"><span class="Apple-converted-space">    </span>console.log (r.id);</p>
<p class="p4">}</p>
<p class="p4">///////</p>
<p class="p5"><br></p>
<p class="p4">var fb = [</p>
<p class="p4"><span class="Apple-converted-space">  </span>{id: "id1", kind: "rect", x: 10, y: 10, width: 15, height: 15},</p>
<p class="p4"><span class="Apple-converted-space">  </span>{id: "id2", kind: "rect", x: 9, y: 15, width: 2, height: 2},</p>
<p class="p4">];</p>
<p class="p5"><br></p>
<p class="p4">for (obj of fb) {</p>
<p class="p4"><span class="Apple-converted-space">    </span>if (obj.kind === "rect") {</p>
<p class="p4"><span class="Apple-tab-span">	</span>console.log (obj.id);</p>
<p class="p4"><span class="Apple-converted-space">    </span>}</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p5"><br></p>
<p class="p4">/// query b ///</p>
<p class="p5"><br></p>
<p class="p4">/// is rectangle id1 bigger than rectangle id2? ///</p>
<p class="p5"><br></p>
<p class="p4">function area (obj) {</p>
<p class="p4"><span class="Apple-converted-space">    </span>var width = obj.width;</p>
<p class="p4"><span class="Apple-converted-space">    </span>var height = obj.height;</p>
<p class="p4"><span class="Apple-converted-space">    </span>return width * height;</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">function bigger (obj1, obj2) {</p>
<p class="p4"><span class="Apple-converted-space">    </span>var area1 = area (obj1);</p>
<p class="p4"><span class="Apple-converted-space">    </span>var area2 = area (obj2);</p>
<p class="p4"><span class="Apple-converted-space">    </span>return (area1 &gt; area2);</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">function fetch (id) {</p>
<p class="p4"><span class="Apple-converted-space">    </span>return fb.find (obj =&gt; id === obj.id);</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">console.log ();</p>
<p class="p5"><br></p>
<p class="p4">console.log (`(b) id1 is bigger than id1: ${bigger(fetch ("id1"), fetch ("id2"))}`);</p>
<p class="p5"><br></p>
<p class="p4">/// query (c)</p>
<p class="p4">console.log (`(c) id2 is bigger than id1: ${bigger(fetch ("id2"), fetch ("id1"))}`);</p>
<p class="p5"><br></p>
<p class="p5"><br></p>
<p class="p4">//////// sub-query - bounding boxes //////////</p>
<p class="p5"><br></p>
<p class="p4">for (obj of fb) {</p>
<p class="p4"><span class="Apple-converted-space">    </span>if (obj.kind === "rect") {</p>
<p class="p4"><span class="Apple-tab-span">	</span>obj.bounding_box_left = obj.x;</p>
<p class="p4"><span class="Apple-tab-span">	</span>obj.bounding_box_top = obj.y;</p>
<p class="p4"><span class="Apple-tab-span">	</span>obj.bounding_box_right = obj.x + obj.width;</p>
<p class="p4"><span class="Apple-tab-span">	</span>obj.bounding_box_bottom = obj.y + obj.height;</p>
<p class="p4"><span class="Apple-converted-space">    </span>}</p>
<p class="p4"><span class="Apple-converted-space">    </span>//console.log (obj);</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p5"><br></p>
<p class="p4">function intersects (subject, object) {</p>
<p class="p4"><span class="Apple-converted-space">    </span>// left side</p>
<p class="p4"><span class="Apple-converted-space">    </span>if (subject.bounding_box_left &lt;= object.bounding_box_left) {</p>
<p class="p4"><span class="Apple-tab-span">	</span>if (subject.bounding_box_right &gt;= object.bounding_box_left) {</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span>return true;</p>
<p class="p4"><span class="Apple-tab-span">	</span>}</p>
<p class="p4"><span class="Apple-converted-space">    </span>};</p>
<p class="p4"><span class="Apple-converted-space">    </span>// right side</p>
<p class="p4"><span class="Apple-converted-space">    </span>if (subject.bounding_box_left &lt;= object.bounding_box_right) {</p>
<p class="p4"><span class="Apple-tab-span">	</span>if (subject.bounding_box_right &gt;= object.bounding_box_right) {</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span>return true;</p>
<p class="p4"><span class="Apple-tab-span">	</span>}</p>
<p class="p4"><span class="Apple-converted-space">    </span>};</p>
<p class="p4"><span class="Apple-converted-space">    </span>// top</p>
<p class="p4"><span class="Apple-converted-space">    </span>if (subject.bounding_box_top &lt;= object.bounding_box_top) {</p>
<p class="p4"><span class="Apple-tab-span">	</span>if (subject.bounding_box_bottom &gt;= object.bounding_box_top) {</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span>return true;</p>
<p class="p4"><span class="Apple-tab-span">	</span>}</p>
<p class="p4"><span class="Apple-converted-space">    </span>};</p>
<p class="p4"><span class="Apple-converted-space">    </span>// bottom</p>
<p class="p4"><span class="Apple-converted-space">    </span>if (subject.bounding_box_top &lt;= object.bounding_box_bottom) {</p>
<p class="p4"><span class="Apple-tab-span">	</span>if (subject.bounding_box_bottom &gt;= object.bounding_box_bottom) {</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">    </span>return true;</p>
<p class="p4"><span class="Apple-tab-span">	</span>}</p>
<p class="p4"><span class="Apple-converted-space">    </span>};</p>
<p class="p4"><span class="Apple-converted-space">    </span>return false;</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">console.log (`(d) id1 intersects id2: ${intersects (fetch ("id1"), fetch ("id2"))}`);</p>
<p class="p4">console.log (`(e) id1 intersects id2: ${intersects (fetch ("id2"), fetch ("id1"))}`);</p>
<p class="p5"><br></p>
<p class="p5"><span class="Apple-converted-space">    </span></p>
<p class="p5"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>PROLOG Queries</b></h2>
<p class="p4">rectangle(id1,nil).</p>
<p class="p4">rectangle(id2,nil).</p>
<p class="p4">x(id1,20).</p>
<p class="p4">x(id2,10).</p>
<p class="p4">y(id1,10).</p>
<p class="p4">y(id2,40).</p>
<p class="p4">width(id1,120).</p>
<p class="p4">width(id2,20).</p>
<p class="p4">height(id1,80).</p>
<p class="p4">height(id2,20).</p>
<p class="p5"><br></p>
<p class="p4">main(Intersections) :-</p>
<p class="p4"><span class="Apple-converted-space">    </span>setof([IDa,IDb],intersects(IDa,IDb),Intersections).</p>
<p class="p5"><br></p>
<p class="p4">area(Subject,A) :-</p>
<p class="p4"><span class="Apple-converted-space">    </span>width(Subject,W),</p>
<p class="p4"><span class="Apple-converted-space">    </span>height(Subject,H),</p>
<p class="p4"><span class="Apple-converted-space">    </span>A is H * W.</p>
<p class="p5"><br></p>
<p class="p4">bigger(Subject, Object) :-</p>
<p class="p4"><span class="Apple-converted-space">    </span>area(Subject,As),</p>
<p class="p4"><span class="Apple-converted-space">    </span>area(Object,Os),</p>
<p class="p4"><span class="Apple-converted-space">    </span>As &gt; Os.</p>
<p class="p5"><br></p>
<p class="p4">left(R,X1) :- x(R,X1).</p>
<p class="p4">top(R,Y1) :- y(R,Y1).</p>
<p class="p4">right(R,X2) :- x(R,X1),width(R,W),X2 is X1 + W.</p>
<p class="p4">bottom(R,Y2) :- y(R,Y1),height(R,H),Y2 is Y1 + H.</p>
<p class="p5"><br></p>
<p class="p4">% left side</p>
<p class="p4">intersects(Subject,Object) :-</p>
<p class="p4"><span class="Apple-converted-space">    </span>dif(Subject,Object),</p>
<p class="p4"><span class="Apple-converted-space">    </span>left(Subject,SubjX1),</p>
<p class="p4"><span class="Apple-converted-space">    </span>left(Object,ObjX1),</p>
<p class="p4"><span class="Apple-converted-space">    </span>SubjX1 =&lt; ObjX1,</p>
<p class="p4"><span class="Apple-converted-space">    </span>right(Subject,SubjX2),</p>
<p class="p4"><span class="Apple-converted-space">    </span>SubjX2 &gt;= ObjX1.</p>
<p class="p4">% right side</p>
<p class="p4">intersects(Subject,Object) :-</p>
<p class="p4"><span class="Apple-converted-space">    </span>dif(Subject,Object),</p>
<p class="p4"><span class="Apple-converted-space">    </span>left(Subject,SubjX1),</p>
<p class="p4"><span class="Apple-converted-space">    </span>right(Object,ObjX2),</p>
<p class="p4"><span class="Apple-converted-space">    </span>SubjX1 =&lt; ObjX2,</p>
<p class="p4"><span class="Apple-converted-space">    </span>right(Subject,SubjX2),</p>
<p class="p4"><span class="Apple-converted-space">    </span>SubjX2 &gt;= ObjX2.</p>
<p class="p4">% top</p>
<p class="p4">intersects(Subject,Object) :-</p>
<p class="p4"><span class="Apple-converted-space">    </span>dif(Subject,Object),</p>
<p class="p4"><span class="Apple-converted-space">    </span>top(Subject,SubjY1),</p>
<p class="p4"><span class="Apple-converted-space">    </span>top(Object,ObjY1),</p>
<p class="p4"><span class="Apple-converted-space">    </span>SubjY1 =&lt; ObjY1,</p>
<p class="p4"><span class="Apple-converted-space">    </span>bottom(Subject,SubjY2),</p>
<p class="p4"><span class="Apple-converted-space">    </span>SubjY2 =&lt; ObjY1.</p>
<p class="p4">% bottom</p>
<p class="p4">intersects(Subject,Object) :-</p>
<p class="p4"><span class="Apple-converted-space">    </span>dif(Subject,Object),</p>
<p class="p4"><span class="Apple-converted-space">    </span>top(Subject,SubjY1),</p>
<p class="p4"><span class="Apple-converted-space">    </span>bottom(Object,ObjY2),</p>
<p class="p4"><span class="Apple-converted-space">    </span>SubjY1 =&lt; ObjY2,</p>
<p class="p4"><span class="Apple-converted-space">    </span>bottom(Subject,SubjY2),</p>
<p class="p4"><span class="Apple-converted-space">    </span>SubjY2 =&lt; ObjY2.</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Basics</b></h2>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>PROLOG Basics - Capitalization</b></h2>
<p class="p2">PROLOG uses capitalization to differentiate between Logic Variables and everything else.<span class="Apple-converted-space">  </span>Logic Variables begin with capital letters, and everything else begins with lower-case letters.</p>
<p class="p3"><br></p>
<p class="p2">A Logic Variable is much like a variable in most languages, but, Logic Variables take on possibly many different values during exhaustive search.<span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">Logic Variables capture snapshots during matching.<span class="Apple-converted-space">  </span>A single logic variable can hold only one value at a time, but that value might change during each wave of pattern matching (see below).</p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>PROLOG Basics - Exhaustive Search</b></h2>
<p class="p2">PROLOG matches patterns in waves.</p>
<p class="p3"><br></p>
<p class="p2">Each wave matches one specific instance of the pattern.</p>
<p class="p3"><br></p>
<p class="p2">Each wave sets Logic Variables to single specific values, but the values might be different in each wave.</p>
<p class="p3"><br></p>
<p class="p2">For example, let us consider the query</p>
<p class="p4">x(ID,Value).</p>
<p class="p3"><br></p>
<p class="p2">The first pattern-matching wave returns X=id1 and Value = 20.</p>
<p class="p3"><br></p>
<p class="p2">The second pattern-matching wave returns X=id2 and Value = 10.</p>
<p class="p3"><br></p>
<p class="p2">[<i>At the REPL, we can ask to see successive waves using a semi-colon.</i>]</p>
<p class="p3"><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>PROLOG Basics - Rules</b></h2>
<p class="p2">PROLOG programs consist of <i>rules</i> of the form</p>
<p class="p4">head(…) :- body(…).</p>
<p class="p5"><br></p>
<p class="p2">Rules are almost like <i>functions</i> in other languages, except that <i>low-level</i> <i>operations</i> can appear in the left-hand side as well as in the right-hand side.</p>
<p class="p3"><br></p>
<p class="p2">Rules specify assertions about the problem space and allow the PROLOG engine to decide how to implement the details.<span class="Apple-converted-space">  </span>Assertions are <i>declarative</i>.</p>
<p class="p3"><br></p>
<p class="p2">For example, the definition of the <i>member</i> rule in PROLOG might be</p>
<p class="p4">member(X, [X|_]).</p>
<p class="p4">member(X, [_|Rest]) :- member(X, Rest).</p>
<p class="p2">Here, we assert that there are two OR'ed-together rules that define list membership.<span class="Apple-converted-space">  </span>The first rule says that X is a member of a list if X is the head of a list.<span class="Apple-converted-space">  </span>Otherwise, recur using the second rule.<span class="Apple-converted-space">  </span>The second rule says that X is a member of a list, if X is the member of the smaller list "Rest" (the head is peeled off leaving a smaller list).</p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>PROLOG Basics - AND</b></h2>
<p class="p2">In PROLOG, the AND of two rules is signified by a comma (,).</p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>PROLOG Basics - OR</b></h2>
<p class="p2">In PROLOG, the OR of two rules is signified by repetition of the rule with slightly different body code.</p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>PROLOG Basics - Rule Clustering</b></h2>
<p class="p2">In PROLOG, all rules that have the same name must be clustered together.</p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>PROLOG Basics - Arity</b></h2>
<p class="p2">In PROLOG, rules are denoted by the number of arguments they take.<span class="Apple-converted-space">  </span>The number of arguments is call <i>arity</i>.<span class="Apple-converted-space">  </span>Internally, rules are denoted as name/N, where N is the <i>arity.</i></p>
<p class="p3"><i></i><br></p>
<p class="p2">For example, in the above member rules, the rules are internally called <span class="s1">member/2</span>.</p>
<p class="p3"><br></p>
<p class="p2">Because rules are name-mangled to include their arity, it is possible to have rules that look the same in the source code, but have different arities.</p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>PROLOG Basics - Two-Way Evaluation</b></h2>
<p class="p2">Because PROLOG rules<a id="fnlink1"></a><a href="#fn1"><sup>[1]</sup></a> cannot specify implementation, PROLOG rules can run in two directions.<span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">This seems unusual, at first, to programmers who are accustomed to using popular languages like Python, Javascript, /bin/sh, etc.</p>
<p class="p3"><br></p>
<p class="p2">An extreme form of the use of relational two-way evaluation can be seen in the Barliman project<a id="fnlink2"></a><a href="#fn2"><sup>[2]</sup></a>.</p>
<p class="p3"><br></p>
<p class="p2">A less-extreme version is the ability to create various queries at the PROLOG REPL.<span class="Apple-converted-space">  </span>For example, we could write</p>
<p class="p4">rectangle(ID,_).</p>
<p class="p2">and get two results (ID=id1 and ID=id2) at the REPL<a id="fnlink3"></a><a href="#fn3"><sup>[3]</sup></a>.</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Reading</b></h2>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>Declarations</b></h2>
<p class="p3"><br></p>
<p class="p2">The first 10 lines define the facts.<span class="Apple-converted-space">  </span>Each fact is of the form <span class="s1">relation(Subject,Object)</span>.</p>
<p class="p3"><br></p>
<p class="p4">rectangle(id1,nil).</p>
<p class="p4">rectangle(id2,nil).</p>
<p class="p4">x(id1,20).</p>
<p class="p4">x(id2,10).</p>
<p class="p4">y(id1,10).</p>
<p class="p4">y(id2,40).</p>
<p class="p4">width(id1,120).</p>
<p class="p4">width(id2,20).</p>
<p class="p4">height(id1,80).</p>
<p class="p4">height(id2,20).</p>
<p class="p3"><br></p>
<p class="p2">The <span class="s1">rectangle</span> facts declare the existence of two rectangles, <span class="s1">id1</span> and <span class="s1">id2</span>.<span class="Apple-converted-space">  </span>The <i>object</i> is <span class="s1">nil</span> in these cases — no further data is supplied in the declarations.</p>
<p class="p3"><br></p>
<p class="p2">The x(), y(), width() and height() facts associate an integer with each of the dimensions of the rectangles.</p>
<p class="p3"><br></p>
<p class="p2">In imperative languages, we might have written<a id="fnlink4"></a><a href="#fn4"><sup>[4]</sup></a>:</p>
<p class="p3"><br></p>
<p class="p4">var id1 : rectangle;</p>
<p class="p4">id1.x = 20;</p>
<p class="p4">id1.y = 10;</p>
<p class="p4">id1.width = 120;</p>
<p class="p4">id1.height = 80;</p>
<p class="p5"><br></p>
<p class="p2">but, that would have been too structured for my liking.<span class="Apple-converted-space">  </span>(PROLOG lets one express these relationships more succinctly, but I desire a machine-readable normal form, and like with assembler, human-readability is secondary).</p>
<p class="p3"><br></p>
<p class="p2">Note that the ID (id1 and id2) in a factbase acts like an<i> object-pointer</i> in other languages.<span class="Apple-converted-space">  </span>Using <i>object+attributes</i> makes sense from a <i>human</i>-readability perspective, but normalizing <i>everything</i> makes more sense from a <i>machine</i>-readability perspective.<span class="Apple-converted-space">  </span>In this case, the <i>pointer</i> is the <i>Subject</i> of most facts, and, everything is expressed in <span class="s1">relation(Subject,Object)</span> form.<span class="Apple-converted-space">  </span>There is no concept of <i>pointers</i> vs. <i>attributes</i> in the <i>machine</i>-readable version<a id="fnlink5"></a><a href="#fn5"><sup>[5]</sup></a>.</p>
<p class="p3"><br></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>Bounding Boxes</b></h2>
<p class="p2">The rules <i>left, top, right</i> and <i>bottom</i> define the rules for bounding boxes for rectangles (we might need to embellish these rules if we were to add ellipses and other kinds of shapes).</p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>Area</b></h2>
<p class="p2">The rule <i>area</i> defines a way to calculate the area of a rectangle.</p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>Bigger</b></h2>
<p class="p2">The rule <i>bigger</i> shows one way<a id="fnlink6"></a><a href="#fn6"><sup>[6]</sup></a> to determine if one rectangle is bigger than another.</p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>Intersects</b></h2>
<p class="p2">The <i>intersects</i> rule is defined in 4 variants.</p>
<p class="p3"><br></p>
<p class="p2">The first variant fires and succeeds if:</p>
<ul class="ul1">
  <li class="li6">Subject and Object are not the same rectangle (dif())</li>
  <li class="li6">subject.x1 &lt;= object.x1, and,</li>
  <li class="li6">subject.x2 &gt;= object.x1.</li>
</ul>
<p class="p7"><br></p>
<p class="p6">The other variants are similar.</p>
<p class="p7"><br></p>
<p class="p6">[<i>Again, the rules are, intentionally, over-simplifications.<span class="Apple-converted-space">  </span>See my further essay(s) on this subject for a more detailed description of the calculation and design rules for intersection.</i>]</p>
<p class="p7"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Running the PROLOG Query</b></h2>
<p class="p2">To run the PROLOG factbase queries:</p>
<p class="p3"><br></p>
<p class="p2">&gt; swipl</p>
<p class="p2">?- consult(fb).</p>
<p class="p2">?- main(X).</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Exhaustive Search is a Strange Beast</b></h2>
<p class="p2">Exhaustive search can provide some surprises to mortal programmers.</p>
<p class="p3"><br></p>
<p class="p2">For example, if we change main to:</p>
<p class="p4">main(Intersections) :-</p>
<p class="p4"><span class="Apple-converted-space">    </span>bagof([IDa,IDb],intersects(IDa,IDb),Intersections).</p>
<p class="p2">we get</p>
<p class="p4">Intersections = [[id2, id1], [id1, id2], [id2, id1]].</p>
<p class="p2">noting that [id2, id1] appears twice in the result.<span class="Apple-converted-space">  </span>[<i>We changed </i><span class="s1">setof</span><i> to </i><span class="s1">bagof</span><i>, that's all.]</i></p>
<p class="p3"><br></p>
<p class="p2">Why does [id2,id1] appear twice?<span class="Apple-converted-space">  </span>Id2 intersects id1 with id2's top and id2's bottom.<span class="Apple-converted-space">  </span>Exhaustive search gives us <i>all</i> of the possible answers.</p>
<p class="p3"><br></p>
<p class="p2">The <i>setof</i> call sorts and unique-ifies the answer set.<span class="Apple-converted-space">  </span>We could also have used PROLOG <i>cut</i> (see PROLOG documentation) to stop matching after the first successful result.</p>
<p class="p3"><br></p>
<p class="p2">BTW, we could have just written a query at the REPL:</p>
<p class="p4">intersects(IDa,IDb).</p>
<p class="p2">(and ask for multiple results by hitting the semi-colon key, until there are no more results).</p>
<p class="p3"><br></p>
<p class="p2">[<i>FYI - the Haskell language and friends, riff on this idea of pattern matching and exhaustive search.<span class="Apple-converted-space">  </span>Compiler technology — parsing in particular — riffed on the ideas of pattern matching decades ago.<span class="Apple-converted-space">  </span>PEG is pattern matching with backtracking.</i>]</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Engineering</b></h2>
<p class="p2">Engineers must consider details that are glossed-over by Architects.</p>
<p class="p3"><br></p>
<p class="p2">(This is not a bad thing.<span class="Apple-converted-space">  </span>Architects need to elide details to be able to think about the designs.<span class="Apple-converted-space">  </span>Engineers dot the I's and cross the T's.<span class="Apple-converted-space">  </span>This same kind of elision happens in other fields, for example mathematics — math equations are usually kept terse (using single-letter names) to allow thinking about the bigger picture.).</p>
<p class="p3"><br></p>
<p class="p2">For example, engineers must consider…</p>
<p class="p3"><br></p>
<p class="p2">What if either rectangle is a point? <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">What if any line is a point?</p>
<p class="p3"><br></p>
<p class="p2">What if lines are parallel? <span class="Apple-converted-space"> </span></p>
<ul class="ul1">
  <li class="li6">Top and Bottom should be parallel. <span class="Apple-converted-space"> </span></li>
  <li class="li6">Left and Right should be parallel. <span class="Apple-converted-space"> </span></li>
  <li class="li6">What if Top is parallel to Left? <span class="Apple-converted-space"> </span></li>
  <li class="li6">Etc.</li>
</ul>
<p class="p7"><br></p>
<p class="p6">[<i>Side note: Currently, programmers do all of the tasks, Architecture, Engineering, Implementation, Testing.<span class="Apple-converted-space">  </span>Some people are better at Architecture.<span class="Apple-converted-space">  </span>Some are better at Engineering. Some are better at Implementation.<span class="Apple-converted-space">  </span>Some are better (more evil) at testing.<span class="Apple-converted-space">  </span>Currently, we pay programmers at a high rate to consider all of the tasks "at once".<span class="Apple-converted-space">  </span>This could be cost-reduced by introducing stratification and layering to the organizations.<span class="Apple-converted-space">  </span>An example would be the stratification that has evolved in building construction.</i>]</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Optimization Engineering</b></h2>
<p class="p2">What about efficiency? <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">Rearrange lines to give better performance? <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">Use cut?<span class="Apple-converted-space">  </span>(Cut is considered to be impure).</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Meta-Question</b></h2>
<p class="p2">The answers to the above queries are "obvious" — we just eye-ball the factbase — but, how can we write code such that the computer can derive these answers for us? <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">When we get into production level factbases, we might have lots of rectangles and we might miss eye-balling some relationships and queries.<a id="fnlink7"></a><a href="#fn7"><sup>[7]</sup></a></p>
<p class="p3"><br></p>
<p class="p2">Humans are notoriously bad at repetitive tasks such as this.<span class="Apple-converted-space">  </span>Computers are great at doing repetitive tasks. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">How can we write programs that will answer these repetitive queries, so we don't have to do the work ourselves? <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">Answer: automate, write scripts, write pipelines.</p>
<p class="p3"><br></p>
<p class="p2">Use automation stacked upon other automation stacked upon other automation and so on.<span class="Apple-converted-space">  </span>Layers and layers of automation. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">So, the meta-meta-question becomes — what makes it easy to write automation scripts? <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">We are lazy — what is the easiest way to stack scripts?<span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">[<i>Side note: whatever we are doing now doesn't stack very well, and we are hitting a wall.<span class="Apple-converted-space">  </span>APIs are just too complicated to stack effectively.<a id="fnlink8"></a></i><a href="#fn8"><sup>[8]</sup></a><i><span class="Apple-converted-space">  </span>We've tried structuring data to make it understandable, but that has its limits, too. The more that the data is structured, the less machine-readable it becomes, hence, the harder it becomes to write scripts.<span class="Apple-converted-space">  </span>Edge-cases kill opportunities for automation.</i>]</p>
<p class="p3"><br></p>
<p class="p2">Compiler-writers have been figuring this stuff out, but they are interested in job security and want to make it look too complicated for use by mere mortals.<a id="fnlink9"></a><a href="#fn9"><sup>[9]</sup></a> <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">Someone released REGEX from its compiler-writers' cage and it is useful. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">What's next?</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Queries - Components</b></h2>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>Gedanken experiment:</b></h2>
<p class="p3"><br></p>
<p class="p2">Let us <i>adopt</i> the <i>convention</i> that only the biggest rectangles represent software components.</p>
<p class="p3"><br></p>
<p class="p2">Queries:<span class="Apple-converted-space"> </span></p>
<ol class="ol1">
  <li class="li6">What are the ids of all of the software components?</li>
</ol>
<p class="p3"><br></p>
<p class="p2">Answers</p>
<ol class="ol1">
  <li class="li6">id1.</li>
</ol>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p6">How did we arrive at this answer?</p>
<p class="p7"><br></p>
<p class="p6">Sub-queries:</p>
<p class="p6">A rectangle is big if it has no<a id="fnlink10"></a><a href="#fn10"><sup>[10]</sup></a> other rectangles bigger than it.</p>
<p class="p7"><br></p>
<p class="p4">forall rectangles R</p>
<p class="p4"><span class="Apple-converted-space">  </span>forall rectangles X, <i>different</i> from R</p>
<p class="p4"><span class="Apple-converted-space">    </span>if isBigger(X,R) then</p>
<p class="p4"><span class="Apple-converted-space">      </span>R is definitely not a Component, and,</p>
<p class="p4"><span class="Apple-converted-space">      </span>X might be a Component</p>
<p class="p5"><br></p>
<p class="p4">then, forall rectangles Y</p>
<p class="p4"><span class="Apple-converted-space">  </span>if mightBeAComponent(Y) then</p>
<p class="p4"><span class="Apple-converted-space">     </span>Y is a Component</p>
<p class="p7"><br></p>
<p class="p6">[<i>FYI - exhaustive search of the first set of foralls guarantees that all left-overs must be Components</i>]</p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p6"><i>meta-question</i>: can you do the above queries without using flags? <span class="Apple-converted-space"> </span></p>
<p class="p7"><br></p>
<p class="p6"><i>answer</i>: no, you <span class="s2">have</span> to use flags, but, maybe you can <span class="s2">elide</span> the flags (different wording: maybe the computer can set the flags for you, because humans are bad at this sort of thing)</p>
<p class="p7"><br></p>
<p class="p6">[<i>spoiler: PROLOG does this kind of exhaustive search and sets bookmarks, but you don't have to worry about the bookmarking, PROLOG does it for you</i>.<span class="Apple-converted-space">  </span><i>MiniKanren (core.logic) does bookmarking, too.<span class="Apple-converted-space">  </span>[PROLOG and miniKanren create bookmarks in different ways, but you don't need to worry about this kind of detail. [Lisp (…/cc, "On Lisp", etc.) gives you the raw materials for creating bookmarks, but you still have to write the code.<span class="Apple-converted-space">  </span>Assembler gives you the raw materials, too, but you have to write even more code.]]</i>]</p>
<p class="p7"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Queries - Ports</b></h2>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>Gedanken experiment (continued):</b></h2>
<p class="p3"><br></p>
<p class="p2">Let us <i>adopt</i> the <i>convention</i> that only smaller rectangles are ports. <span class="Apple-converted-space"> </span></p>
<p class="p3"><br></p>
<p class="p2">(N.B. port-ness is still inconclusive — we will want to know whether a port is <i>input </i>or <i>output</i>, but I regress).</p>
<p class="p3"><br></p>
<p class="p3"><br></p>
<p class="p2">Queries:<span class="Apple-converted-space"> </span></p>
<ol class="ol1">
  <li class="li6">What are the ids of all of the ports?</li>
  <li class="li6">Who "owns" which ports?</li>
</ol>
<p class="p3"><br></p>
<p class="p2">Answers</p>
<ol class="ol1">
  <li class="li6">id2.</li>
  <li class="li6">id2 is a port of id1.<span class="Apple-converted-space">  </span>In other words: id1 owns port id2.</li>
</ol>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p6">How did we arrive at this answer?</p>
<p class="p7"><br></p>
<p class="p6">In PROLOG, we can write</p>
<p class="p4">port(Port,Owner) :-</p>
<p class="p4"><span class="Apple-converted-space">    </span>rectangle(Port,_),</p>
<p class="p4"><span class="Apple-converted-space">    </span>rectangle(Owner,_),</p>
<p class="p4"><span class="Apple-converted-space">    </span>bigger(Owner,Port).</p>
<p class="p7"><br></p>
<p class="p6">and use the query</p>
<p class="p4">port(P,O).</p>
<p class="p6">to find all ports and their owners.</p>
<p class="p7"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Appendix - Searching</b></h2>
<p class="p2">miniKanren: <a href="http://minikanren.org">http://minikanren.org</a></p>
<p class="p3"><br></p>
<p class="p2">Scheme - miniKanren</p>
<p class="p3"><br></p>
<p class="p2">Scheme - a simple version of PROLOG is available at <a href="https://www.t3x.org/bits/prolog6.html">https://www.t3x.org/bits/prolog6.html</a></p>
<p class="p3"><br></p>
<p class="p2">JavaScript - <a href="https://github.com/guitarvydas/js-match">https://github.com/guitarvydas/js-match</a></p>
<p class="p3"><br></p>
<p class="p2">Clojure - core.logic</p>
<p class="p3"><br></p>
<p class="p2">PROLOG - <a href="https://www.swi-prolog.org/">https://www.swi-prolog.org/</a></p>
<p class="p3"><br></p>
<p class="p2">Getting started with PROLOG pattern matching - https://www.youtube.com/watch?v=QOYAHoLiyg0&amp;t=195s</p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Appendix - Github Code</b></h2>
<p class="p2"><a href="https://github.com/guitarvydas/factbases-101">https://github.com/guitarvydas/factbases-101</a></p>
<p class="p3"><br></p>
<h2 style="margin: 24.0px 0.0px 12.0px 0.0px; font: 20.0px Helvetica"><b>Appendix - Compiling Diagrams</b></h2>
<p class="p2">Compiling diagrams consists of 2 steps:</p>
<ol class="ol2">
  <li class="li6">normalize the diagram to a factbase</li>
  <li class="li6">query the factbase, recursively, to create more-and-more-interesting facts.</li>
</ol>
<p class="p3"><br></p>
<p class="p2">In the above, I have shown how to represent rectangles in a factbase.</p>
<p class="p3"><br></p>
<p class="p2">Let us assume that we are using a notation that needs only:</p>
<ul class="ul1">
  <li class="li6">rectangles</li>
  <li class="li6">lines</li>
  <li class="li6">text.</li>
</ul>
<p class="p3"><br></p>
<p class="p2">FYI — I have found this simple combination enough to express concurrency…</p>
<ul class="ul1">
  <li class="li6">rectangles represent concurrent Software Components</li>
  <li class="li6">lines represent messages<a id="fnlink11"></a><a href="#fn11"><sup>[11]</sup></a> (data flow) between Software Components</li>
  <li class="li6">text represents code and comments.</li>
</ul>
<p class="p7"><br></p>
<p class="p6">[<i>N.B. Software Components are not implemented using CALL / RETURN only.<span class="Apple-converted-space">  </span>See my other essay </i><a href="https://guitarvydas.github.io/2020/12/09/CALL-RETURN-Spaghetti.html"><i>https://guitarvydas.github.io/2020/12/09/CALL-RETURN-Spaghetti.html</i></a><i>]</i></p>
<p class="p7"><i></i><br></p>
<p class="p6">Questions:</p>
<ul class="ul1">
  <li class="li6">How to internally represent rectangles (see <i>bounding boxes</i> above)?</li>
  <li class="li6">How to internally represent lines?<span class="Apple-converted-space">  </span>(We only care about the start points of lines and the end points of lines ; do we create bounding boxes for lines or use special edge-case code for lines?]</li>
  <li class="li6">How to internally represent code (code is not automatically sequential, blocks of code are found at various (x,y) points, what does <i>that</i> mean?).</li>
</ul>
<p class="p7"><br></p>
<p class="p6">We can compile diagrams in successive layers:</p>
<ol class="ol2">
  <li class="li6">layer 0 is the actual drawing converted to FB (factbase) form</li>
  <li class="li6">layer 1 infers bounding boxes and augments the FB with this information</li>
  <li class="li6">layer 2 infers which rectangles are Software Components and augments the FB with this information</li>
  <li class="li6">layer 3 infers which rectangles are Ports and augments the FB</li>
  <li class="li6">layer 4 infers the Owner for each Port</li>
  <li class="li6">layer 5 visits every Port and infers whether the port is <i>input</i> or <i>output</i>.<span class="Apple-converted-space">  </span>Q: What is the convention for this?<span class="Apple-converted-space">  </span>The shape of the port (e.g. circles for inputs, squares for outputs) or, maybe the colour (green for inputs, yellow for outputs) and so on.</li>
  <li class="li6">…</li>
</ol>
<p class="p7"><br></p>
<p class="p6">Q: How much information must be in the FB before we can emit code using information in the FB?</p>
<p class="p7"><br></p>
<p class="p6">Q: Is this information language-specific?<span class="Apple-converted-space">  </span>E.G. if we know that we are going to emit code in Lisp, do we need more/less information than if we are going to emit code in, say, Python? <span class="Apple-converted-space"> </span></p>
<p class="p7"><br></p>
<p class="p6">Q: Do we grow the FB knowledge-base over time or design it in one-fell-swoop at the beginning of the project(s)?</p>
<p class="p7"><br></p>
<hr>
<p class="p6"><a id="fn1"></a><a href="#fnlink1">[1]</a> Rules specify only the result (the assertions).</p>
<p class="p9"><span class="s3"><a id="fn2"></a><a href="#fnlink2">[2]</a> </span>https://www.youtube.com/watch?v=er_lLvkklsk</p>
<p class="p9"><a id="fn3"></a><a href="#fnlink3"><span class="s3">[3]</span></a><span class="s3"> </span>In SWIPL, one needs to enter the semi-colon to receive successive match waves and to see the various results of each wave.</p>
<p class="p9"><a id="fn4"></a><a href="#fnlink4"><span class="s3">[4]</span></a><span class="s3"> </span>pseudo-code</p>
<p class="p9"><a id="fn5"></a><a href="#fnlink5"><span class="s3">[5]</span></a><span class="s3"> </span>If we wanted to look at objects + attributes, we could just write an SCN that gave us that view (aka skin) on the data.</p>
<p class="p9"><a id="fn6"></a><a href="#fnlink6"><span class="s3">[6]</span></a><span class="s3"> </span>Again, I am simplifying in an attempt to maintain readability.<span class="Apple-converted-space">  </span>A production version of the rules in this essay would need to handle more edge-cases and shapes.</p>
<p class="p9"><a id="fn7"></a><a href="#fnlink7"><span class="s3">[7]</span></a><span class="s3"> </span>Furthermore, we might choose to include other kinds of objects, e.g. ellipses.</p>
<p class="p9"><a id="fn8"></a><a href="#fnlink8"><span class="s3">[8]</span></a><span class="s3"> </span>meta-meta-observation: we solve complicated problems by adding complication.</p>
<p class="p9"><a id="fn9"></a><a href="#fnlink9"><span class="s3">[9]</span></a><span class="s3"> </span>meta-meta-question: Why do we do DRY by hand?<span class="Apple-converted-space">  </span>Why can't git detect code clones for us?<span class="Apple-converted-space">  </span>Beginners like RY - they want to copy/paste cookbook code.</p>
<p class="p9"><a id="fn10"></a><a href="#fnlink10"><span class="s3">[10]</span></a><span class="s3"> </span>Notice that our convention is that diagrams of components cannot contain other diagrams in-place.<span class="Apple-converted-space">  </span>We need to switch to other diagrams to show deep-ness.<span class="Apple-converted-space">  </span>In this notation, every diagram has 2 layers: (1) the top level and (2) an inner level.<span class="Apple-converted-space">  </span>There is never an inner-inner level (such a thing can exist but cannot be shown on the same diagram - the editor should allow us to dive into and out-of diagram layers - much like the BACK button on browsers).</p>
<p class="p10"><a id="fn11"></a><a href="#fnlink11"><span class="s3">[11]</span></a><span class="s3"> </span>Dynamically changing data flow is a bad thing IMO.<span class="Apple-converted-space">  </span>Dynamic &lt;anything&gt; leads to trouble (esp. maintenance and debugging). https://guitarvydas.github.io/2021/03/06/Dynamic-Anything-is-Bad.html.<span class="Apple-converted-space">  </span>IMO, data flows must be represented explicitly, for example, as arrows.</p>
</div>
<script src="https://utteranc.es/client.js" 
        repo="guitarvydas/guitarvydas.github.io" 
        issue-term="pathname" 
        theme="github-light" 
        crossorigin="anonymous" 
        async> 
</script> 
</body>
</html>
